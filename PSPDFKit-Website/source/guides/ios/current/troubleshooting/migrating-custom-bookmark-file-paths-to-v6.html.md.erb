---
title: Migrating Custom Bookmark File Paths to PSPDFKit v6
section: developers

secret: true
---

PSPDFKit 6.0 for iOS removes the old `PSPDFBookmarkParser` and instead introduces a `PSPDFBookmarkManager` that gives you more customization options. Additionally, beginning with PSPDFKit 6.0, the bookmark manager stores bookmarks inside the PDF itself by default and no longer uses an external file to do so. This allows users to access their bookmarks in other apps, such as Apple’s Preview.

If you previously changed the location of the external file but still used our file format, this can cause trouble when migrating to `PSPDFBookmarkManager`, as there is no public way to read this file in PSPDFKit 6.0 anymore. The following workaround illustrates two ways to make the internal migrator pick up the old file and merge it into the PDF.

## Move the File

Old bookmark data was stored in the `Documents` data directory inside a file named `bookmarks.pspdfkit`. Before creating a `PSPDFDocument`, check if you have non-migrated bookmark data available and copy it over to this path. The migrator will check for this file, migrate the bookmarks, and, if migration succeeded, delete the file afterward:

[==

```swift
let document = PSPDFDocument(url: writableURL)
let targetPath = (document.dataDirectory as NSString).appendingPathComponent("bookmarks.pspdfkit")
try! FileManager.default.moveItem(atPath: yourBookmarkPath, toPath: targetPath)
// Start working with the document (e.g. pass it to a `PSPDFViewController`).
```

```objc
PSPDFDocument *document = [[PSPDFDocument alloc] initWithURL:writableURL];
NSError *error;
NSString *targetPath = [document.dataDirectory stringByAppendingPathComponent:@"bookmarks.pspdfkit"];
if ([[NSFileManager defaultManager] moveItemAtPath:yourBookmarkPath toPath:targetPath error:&error]) {
	// TODO: start working with the document (e.g. pass it to a `PSPDFViewController`)
}
```

==]

## Change the File Path

The second option is to change the path where the migrator will look for the bookmark files. This solution has the benefit that you don’t need to change all the places where you initialize a document. The downside is that PSPDFKit does not provide a public API for changing the path for several reasons, so the only thing you can do here is to swizzle the method that returns the path.

The method you need to replace is `+bookmarkPathForDocument:` on the private class `PSPDFV5ToV6BookmarkMigration`. It takes an instance of `PSPDFDocument` and always returns the path to where the bookmark file would be. If there is no bookmark data, it still needs to return a file path. The migrator checks the path and skips migration if the file does not exist.

The easiest approach is to create a new class with the following methods, but depending on your environment, you may need to alter this sample. Make sure to `#import <objc/runtime.h>` for this to work:

```objc
+ (NSString *)bookmarkPathForDocument:(PSPDFDocument *)document {
	// TODO: Return path to bookmark file. Make sure to always return a path. If the file does not exist, migration will be skipped.
    return @"/path/to/bookmark/file";
}

+ (void)load {
    Class klass = object_getClass(NSClassFromString(@"PSPDFV5ToV6BookmarkMigration"));
    if (klass) {
	    SEL selector = @selector(bookmarkPathForDocument:);
	    Method newMethod = class_getClassMethod(self.class, selector);
	    class_replaceMethod(klass, selector, method_getImplementation(newMethod), method_getTypeEncoding(newMethod));
    }
}
```

**⚠️ Important:** If you choose this option, make sure to always check if it still works when you update to a new version of PSPDFKit, e.g. by writing a test that checks if `PSPDFV5ToV6BookmarkMigration` is still there and has a method named `bookmarkPathForDocument:`.
